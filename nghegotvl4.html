<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="dropdownmenu.css">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
            rel="stylesheet">
        <title>Nghe ch√≠nh t·∫£ L·ªõp 4</title>
        <style>
            .Logo{
                color: rgb(255, 255, 255);
                font-size: xx-large;
                font-weight: 700;
                font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
                padding-left: 20px;
                padding-right: 30px;
                padding-top: 20px;
                padding-bottom: 20px;
                background-color: rgb(114, 149, 77);
                width: 300px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            }
            
            .TV4{
                color:rgb(41, 53, 28);
                text-align-last: center;
                font-size: xx-large;
                font-weight: 700;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                padding-top: 50px;
                padding-bottom: 15px;                
            }

            .dangbaitap{
                display: grid;
                grid-template-columns: 1fr 1fr 1fr 1fr;
                color: rgb(42, 42, 42);
                align-items: center;
                text-align: center;
                font-size: large;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                }
            
                .box1{
                    background-color: rgb(241, 241, 241);
                    padding-top: 5px;
                    padding-bottom: 5px;
                    margin: 2px;
                }
                .box2{
                    background-color: rgb(241, 241, 241);
                    padding-top: 5px;
                    padding-bottom: 5px;
                    margin: 2px;
                }
                .box3{
                    background-color: rgb(241, 241, 241);
                    padding-top: 5px;
                    padding-bottom: 5px;
                    margin: 2px;
                }
                .box4{
                    background-color: rgb(241, 241, 241);
                    padding-top: 5px;
                    padding-bottom: 5px;
                    margin: 2px;
                }

            :root{--bg:white;--card:#fff;--accent:rgb(83, 113, 83);--success:#16a34a;--danger:#ef4444}
            body{font-family:system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:var(--bg);color:#0f172a}
            .wrap{max-width:1000px;padding:20px;margin-left: 100px; margin-right: 100px;}
            .card{background:var(--card);border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.06);padding:30px}
            h1{margin:0 0 8px;font-size:22px}
            p.lead{margin:0 0 18px;color:#334155}
            .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
            button{background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
            button.secondary{background:transparent;color:var(--accent);border:2px solid var(--accent)}
            button.danger{background:var(--danger)}
            button:active{transform:translateY(1px)}
            .input-row{display:flex;gap:8px;align-items:center;margin:12px 0}
            input[type="text"]{flex:1;padding:10px;border-radius:8px;border:1px solid #e6eef8;font-size:16px}
            .feedback{min-height:28px;margin-top:8px}
            .small{font-size:13px;color:#475569}
            .progress{display:flex;gap:8px;align-items:center;margin-top:12px}
            .pill{background:#eef2ff;color:rgb(83, 113, 83);padding:6px 10px;border-radius:999px;font-weight:600}
            .score{margin-left:auto;font-weight:700}
            ul.word-list{display:none;gap:8px;flex-wrap:wrap;padding:0;margin:12px 0 0;list-style:none}
            ul.word-list li{background:#f1f5f9;padding:6px 10px;border-radius:8px;font-size:14px}
            .sr-only{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
            @media (max-width:520px){.wrap{margin:16px;padding:12px}}        

            .targetunit{background:rgb(83, 113, 83);color:white;align-self: center;padding:5px;cursor:pointer}
            .units{background:white;color:rgb(83, 113, 83);border:1px solid rgb(83, 113, 83);align-self: center;padding:5px;cursor:pointer}

            .targetunit:hover {transform: scale(1.1);}
            .units:hover {transform: scale(1.1);}
        </style>
    </head>
    <body>
        <!-- Ph·∫ßn ƒë·∫ßu trang -->
        <div style="
            display: grid;
            grid-template-columns: 310px 1fr;">
            <div class="Logo">Ms.Nhung English</div>
            <nav class="navbar">
                <ul class="nav-links">
                    <li class="nav-link">
                        <a href="#">Trang ch·ªß</a>
                    </li>

                    <li class="nav-link">
                        <a href="#">C√°c kh√≥a h·ªçc</a>
                    </li>

                    <li class="nav-link services">
                        <a href="#">T·ª´ V·ª±ng
                            <span class="material-icons dropdown-icon">
                                arrow_drop_down
                            </span>
                        </a>
                        <ul class="drop-down">
                            <li> <a href="tuvungtienganhlop2.html" target="_self">L·ªõp 2</a></li>
                            <li> <a href="tuvungtienganhlop3.html" target="_self">L·ªõp 3</a></li>
                            <li> <a href="tuvungtienganhlop4.html" target="_self">L·ªõp 4</a></li>
                            <li> <a href="tuvungtienganhlop5.html" target="_self">L·ªõp 5</a></li>
                        </ul>
                    </li>

                    <li class="nav-link">
                        <a href="#">Luy·ªán Nghe</a>
                    </li>

                    <li class="nav-link">
                        <a href="#">Luy·ªán ƒê·ªçc</a>
                    </li>

                    <li class="nav-link">
                        <a href="#">Ng·ªØ Ph√°p</a>
                    </li>

                </ul>    
            </nav>
        </div>

        <div style="
            display: grid;
            grid-template-rows: 2fr 1fr;">  
            <div class="TV4"><a href="tuvungtienganhlop4.html"target="_self">TI·∫æNG ANH L·ªöP 4</a></div>
            <div class="dangbaitap">
                <div class="box1"><a href="tuvungtienganhlop4.html" target="_self">&#128210 B·ªô t·ª´ v·ª±ng</a></div>
                <div class="box2"><a href="Matchl4u1.html">&#129513 Gh√©p t·ª´</a></div>
                <div class="box3"><a href="nghegotvl4.html" target="_self">&#127911 Nghe ch√≠nh t·∫£</a></div>
                <div class="box4">&#128221 Ng·ªØ ph√°p</div>
            </div>
        </div>
        <!-- Ph·∫ßn ch√≠nh -->
        <div style="height: 30px;"></div> 
        <div style="display:grid;grid-template-columns: 105px 1fr 160px;">
            <div style="display: grid;grid-template-columns: 105px;margin-left: 5px">
                <p class="targetunit"><strong>T·ªïng h·ª£p</strong></p>
                <p class="units"><a href="nghegotvl4st.html" target="_self"><strong>Starter</strong></a></p>
                <p class="units"><a href="nghegotvl4u1.html" target="_self"><strong>Unit 1</strong></a></p>
                <p class="units"><a href="nghegotvl4u2.html" target="_self"><strong>Unit 2</strong></a></p>
                <p class="units"><a href="nghegotvl4u3.html" target="_self"><strong>Unit 3</strong></a></p>
                <p class="units"><a href="nghegotvl4u4.html" target="_self"><strong>Unit 4</strong></a></p>
                <p class="units"><a href="nghegotvl4u5.html" target="_self"><strong>Unit 5</strong></a></p>
                <p class="units"><a href="nghegotvl4u6.html" target="_self"><strong>Unit 6</strong></a></p>
            </div>
            <div class="wrap card" role="main">
                <h1>LUY·ªÜN NGHE CH√çNH T·∫¢ T·ª™ V·ª∞NG L·ªöP 4</h1>
                <p class="lead">Nghe v√† g√µ t·ª´ em nghe ƒë∆∞·ª£c v√†o √¥ tr·ªëng ph√≠a d∆∞·ªõi</p>

                <div class="controls" role="region" aria-label="ƒêi·ªÅu khi·ªÉn b√†i t·∫≠p">
                <button id="playBtn">‚ñ∂ Ph√°t</button>
                <button id="repeatBtn" class="secondary">X√°o tr·ªôn t·ª´</button>
                <button id="checkBtn">‚úî Ki·ªÉm tra</button>
                <button id="nextBtn" class="secondary">‚û° Ti·∫øp theo</button>
                <button id="showBtn" class="secondary">üëÅ Hi·ªán ƒë√°p √°n</button>
                <button id="resetBtn" class="danger">‚ü≤ Reset</button>
                </div>

                <div class="input-row">
                <label for="answer" class="sr-only">G√µ t·ª´ em nghe ƒë∆∞·ª£c</label>
                <input id="answer" type="text" autocomplete="off" placeholder="G√µ t·ª´ em nghe ƒë∆∞·ª£c r·ªìi nh·∫•n Ki·ªÉm tra" />
                <div class="pill small" id="langLabel">Ng√¥n ng·ªØ: en-US</div>
                </div>

                <div class="feedback" id="feedback" aria-live="polite"></div>

                <div class="progress">
                <div class="small">T·ª´: <span id="index">0</span>/<span id="total">0</span></div>
                <div class="score">ƒêi·ªÉm: <span id="score">0</span></div>
                </div>

                <hr />
                <ul class="word-list" id="wordList"></ul>
            </div>

            <script>
                // C·∫•u h√¨nh: danh s√°ch t·ª´. M·ªói ph·∫ßn t·ª≠ c√≥ {text, audioUrl(optional), lang(optional)}
                const words = [
                {text: 'doctor', lang: 'en-US', audioUrl: 'Auff4/08doctor.mp3'},
                {text: 'pilot', lang: 'en-US', audioUrl: 'Auff4/09pilot.mp3'},
                {text: 'firefighter', lang: 'en-US', audioUrl: 'Auff4/10firefighter.mp3'},
                {text: 'student', lang: 'en-US', audioUrl: 'Auff4/11student.mp3'},
                {text: 'teacher', lang: 'en-US', audioUrl: 'Auff4/12teacher.mp3'},
                {text: 'police officer', lang: 'en-US', audioUrl: 'Auff4/13policeofficer.mp3'},
                {text: 'farmer', lang: 'en-US', audioUrl: 'Auff4/14farmer.mp3'},
                {text: 'hospital', lang: 'en-US', audioUrl: 'Auff4/15hospital.mp3'},
                {text: 'airport', lang: 'en-US', audioUrl: 'Auff4/16airport.mp3'},
                {text: 'police station', lang: 'en-US', audioUrl: 'Auff4/17policestation.mp3'},
                {text: 'fire station', lang: 'en-US', audioUrl: 'Auff4/18firestation.mp3'},
                {text: 'store', lang: 'en-US', audioUrl: 'Auff4/19store.mp3'},
                {text: 'office', lang: 'en-US', audioUrl: 'Auff4/20office.mp3'},
                {text: 'farm', lang: 'en-US', audioUrl: 'Auff4/21farm.mp3'},
                {text: 'bank', lang: 'en-US', audioUrl: 'Auff4/22bank.mp3'},
                {text: 'fries', lang: 'en-US', audioUrl: 'Auff4/23fries.mp3'},
                {text: 'noodles', lang: 'en-US', audioUrl: 'Auff4/24noodles.mp3'},
                {text: 'pizza', lang: 'en-US', audioUrl: 'Auff4/25pizza.mp3'},
                {text: 'bubble tea', lang: 'en-US', audioUrl: 'Auff4/26bubbletea.mp3'},
                {text: 'chicken', lang: 'en-US', audioUrl: 'Auff4/27chicken.mp3'},
                {text: 'ten', lang: 'en-US', audioUrl: 'Auff4/28ten.mp3'},
                {text: 'twenty', lang: 'en-US', audioUrl: 'Auff4/29twenty.mp3'},
                {text: 'twenty one', lang: 'en-US', audioUrl: 'Auff4/30twentyone.mp3'},
                {text: 'twenty two', lang: 'en-US', audioUrl: 'Auff4/31twentytwo.mp3'},
                {text: 'twenty three', lang: 'en-US', audioUrl: 'Auff4/32twentythree.mp3'},
                {text: 'twenty four', lang: 'en-US', audioUrl: 'Auff4/33twentyfour.mp3'},
                {text: 'twenty five', lang: 'en-US', audioUrl: 'Auff4/34twentyfive.mp3'},
                {text: 'twenty six', lang: 'en-US', audioUrl: 'Auff4/35twentysix.mp3'},
                {text: 'twenty seven', lang: 'en-US', audioUrl: 'Auff4/36twentyseven.mp3'},
                {text: 'twenty eight', lang: 'en-US', audioUrl: 'Auff4/37twentyeight.mp3'},
                {text: 'twenty nine', lang: 'en-US', audioUrl: 'Auff4/38twentynine.mp3'},
                {text: 'thirty', lang: 'en-US', audioUrl: 'Auff4/39thirty.mp3'},
                {text: 'forty', lang: 'en-US', audioUrl: 'Auff4/40forty.mp3'},
                {text: 'fifty', lang: 'en-US', audioUrl: 'Auff4/41fifty.mp3'},
                {text: 'sixty', lang: 'en-US', audioUrl: 'Auff4/42sixty.mp3'},
                {text: 'seventy', lang: 'en-US', audioUrl: 'Auff4/43seventy.mp3'},
                {text: 'eighty', lang: 'en-US', audioUrl: 'Auff4/44eighty.mp3'},
                {text: 'ninety', lang: 'en-US', audioUrl: 'Auff4/45ninety.mp3'},
                {text: 'one hundred', lang: 'en-US', audioUrl: 'Auff4/46onehundred.mp3'},
                {text: 'fire truck', lang: 'en-US', audioUrl: 'Auff4/47firetruck.mp3'},
                {text: 'ladder', lang: 'en-US', audioUrl: 'Auff4/48ladder.mp3'},
                {text: 'helmet', lang: 'en-US', audioUrl: 'Auff4/49helmet.mp3'},
                {text: 'uniform', lang: 'en-US', audioUrl: 'Auff4/50uniform.mp3'},
                {text: 'art', lang: 'en-US', audioUrl: 'Auff4/51art.mp3'},
                {text: 'math', lang: 'en-US', audioUrl: 'Auff4/52math.mp3'},
                {text: 'english', lang: 'en-US', audioUrl: 'Auff4/53english.mp3'},
                {text: 'PE', lang: 'en-US', audioUrl: 'Auff4/54PE.mp3'},
                {text: 'Vietnamese', lang: 'en-US', audioUrl: 'Auff4/55Vietnamese.mp3'},
                {text: 'schoolyard', lang: 'en-US', audioUrl: 'Auff4/56schoolyard.mp3'},
                {text: 'artroom', lang: 'en-US', audioUrl: 'Auff4/57artroom.mp3'},
                {text: 'computer room', lang: 'en-US', audioUrl: 'Auff4/58computerroom.mp3'},
                {text: 'read', lang: 'en-US', audioUrl: 'Auff4/59read.mp3'},
                {text: 'surf', lang: 'en-US', audioUrl: 'Auff4/60surf.mp3'},
                {text: 'play with a ball', lang: 'en-US', audioUrl: 'Auff4/61playwithaball.mp3'},
                {text: 'go on a boat', lang: 'en-US', audioUrl: 'Auff4/62goonaboat.mp3'},
                {text: 'snorkel', lang: 'en-US', audioUrl: 'Auff4/63snorkel.mp3'},
                {text: 'collect shells', lang: 'en-US', audioUrl: 'Auff4/64collectshells.mp3'},
                {text: 'swimming', lang: 'en-US', audioUrl: 'Auff4/65swimming.mp3'},
                {text: 'sitting', lang: 'en-US', audioUrl: 'Auff4/66sitting.mp3'},
                {text: 'running', lang: 'en-US', audioUrl: 'Auff4/67running.mp3'},
                {text: 'penguin', lang: 'en-US', audioUrl: 'Auff4/68penguin.mp3'},
                {text: 'zebra', lang: 'en-US', audioUrl: 'Auff4/69zebra.mp3'},
                {text: 'kangaroo', lang: 'en-US', audioUrl: 'Auff4/70kangaroo.mp3'},
                {text: 'camel', lang: 'en-US', audioUrl: 'Auff4/71camel.mp3'},
                {text: 'lizard', lang: 'en-US', audioUrl: 'Auff4/72lizard.mp3'},
                {text: 'crocodile', lang: 'en-US', audioUrl: 'Auff4/73crocodile.mp3'},
                {text: 'float', lang: 'en-US', audioUrl: 'Auff4/74float.mp3'},
                {text: 'sink', lang: 'en-US', audioUrl: 'Auff4/75sink.mp3'},
                {text: 'air', lang: 'en-US', audioUrl: 'Auff4/76air.mp3'},
                {text: 'light', lang: 'en-US', audioUrl: 'Auff4/77light.mp3'},
                {text: 'heavy', lang: 'en-US', audioUrl: 'Auff4/78heavy.mp3'},
                {text: 'rainy', lang: 'en-US', audioUrl: 'Auff4/79rainy.mp3'},
                {text: 'windy', lang: 'en-US', audioUrl: 'Auff4/80windy.mp3'},
                {text: 'hot', lang: 'en-US', audioUrl: 'Auff4/81hot.mp3'},
                {text: 'cold', lang: 'en-US', audioUrl: 'Auff4/82cold.mp3'},
                {text: 'snowy', lang: 'en-US', audioUrl: 'Auff4/83snowy.mp3'},
                {text: 'sunny', lang: 'en-US', audioUrl: 'Auff4/84sunny.mp3'},
                {text: 'fly a kite', lang: 'en-US', audioUrl: 'Auff4/85flightakite.mp3'},
                {text: 'make a snowman', lang: 'en-US', audioUrl: 'Auff4/86makeasnowman.mp3'},
                {text: 'go outside', lang: 'en-US', audioUrl: 'Auff4/87gooutside.mp3'},
                {text: 'candy', lang: 'en-US', audioUrl: 'Auff4/88candy.mp3'},
                {text: 'balloon', lang: 'en-US', audioUrl: 'Auff4/89balloon.mp3'},
                {text: 'present', lang: 'en-US', audioUrl: 'Auff4/90present.mp3'},
                {text: 'candle', lang: 'en-US', audioUrl: 'Auff4/91candle.mp3'},
                {text: 'neighbor', lang: 'en-US', audioUrl: 'Auff4/92neighbor.mp3'},
                {text: 'invite', lang: 'en-US', audioUrl: 'Auff4/93invite.mp3'},
                {text: 'gift card', lang: 'en-US', audioUrl: 'Auff4/94giftcard.mp3'},
                {text: 'chocolate', lang: 'en-US', audioUrl: 'Auff4/95chocolate.mp3'},
                {text: 'get up', lang: 'en-US', audioUrl: 'Auff4/96getup.mp3'},
                {text: 'have breakfast', lang: 'en-US', audioUrl: 'Auff4/97havebreakfast.mp3'},
                {text: 'go to school', lang: 'en-US', audioUrl: 'Auff4/98gotoschool.mp3'},
                {text: 'go home', lang: 'en-US', audioUrl: 'Auff4/99gohome.mp3'},
                {text: 'have dinner', lang: 'en-US', audioUrl: 'Auff4/100havedinner.mp3'},
                {text: 'go to bed', lang: 'en-US', audioUrl: 'Auff4/101gotobed.mp3'},
                {text: 'two fifteen', lang: 'en-US', audioUrl: 'Auff4/102twofifteen.mp3'},
                {text: 'two thirty', lang: 'en-US', audioUrl: 'Auff4/103twothirty.mp3'},
                {text: 'two forty five', lang: 'en-US', audioUrl: 'Auff4/104twofortyfive.mp3'},
                {text: 'survey', lang: 'en-US', audioUrl: 'Auff4/105survey.mp3'},
                {text: 'bar chart', lang: 'en-US', audioUrl: 'Auff4/106barchart.mp3'},
                {text: 'row', lang: 'en-US', audioUrl: 'Auff4/107row.mp3'},
                {text: 'column', lang: 'en-US', audioUrl: 'Auff4/108column.mp3'},
                {text: 'read comics', lang: 'en-US', audioUrl: 'Auff4/109readcomics.mp3'},
                {text: 'play chess', lang: 'en-US', audioUrl: 'Auff4/110playchess.mp3'},
                {text: 'fish', lang: 'en-US', audioUrl: 'Auff4/111fish.mp3'},
                {text: 'play basketball', lang: 'en-US', audioUrl: 'Auff4/112playbasketball.mp3'},
                {text: 'play volleyball', lang: 'en-US', audioUrl: 'Auff4/113playvolleyball.mp3'},
                {text: 'play badminton', lang: 'en-US', audioUrl: 'Auff4/114playbadminton.mp3'},
                {text: 'next to', lang: 'en-US', audioUrl: 'Auff4/115nextto.mp3'},
                {text: 'opposite', lang: 'en-US', audioUrl: 'Auff4/116opposite.mp3'},
                {text: 'between', lang: 'en-US', audioUrl: 'Auff4/117between.mp3'},
                {text: 'turn left', lang: 'en-US', audioUrl: 'Auff4/118turnleft.mp3'},
                {text: 'turn right', lang: 'en-US', audioUrl: 'Auff4/119turnright.mp3'},
                {text: 'go straight', lang: 'en-US', audioUrl: 'Auff4/120gostraight.mp3'},
                {text: 'train station', lang: 'en-US', audioUrl: 'Auff4/121trainstation.mp3'},
                {text: 'busstation', lang: 'en-US', audioUrl: 'Auff4/122busstation.mp3'},
                {text: 'supermarket', lang: 'en-US', audioUrl: 'Auff4/123supermarket.mp3'},
                {text: 'old', lang: 'en-US', audioUrl: 'Auff4/124old.mp3'},
                {text: 'young', lang: 'en-US', audioUrl: 'Auff4/125young.mp3'},
                {text: 'handsome', lang: 'en-US', audioUrl: 'Auff4/126handsome.mp3'},
                {text: 'pretty', lang: 'en-US', audioUrl: 'Auff4/127pretty.mp3'},
                {text: 'cute', lang: 'en-US', audioUrl: 'Auff4/128cute.mp3'},
                {text: 'smart', lang: 'en-US', audioUrl: 'Auff4/129smart.mp3'},
                {text: 'neat', lang: 'en-US', audioUrl: 'Auff4/130neat.mp3'},
                {text: 'messy', lang: 'en-US', audioUrl: 'Auff4/131messy.mp3'},
                {text: 'floor', lang: 'en-US', audioUrl: 'Auff4/132floor.mp3'},
                {text: 'volcano', lang: 'en-US', audioUrl: 'Auff4/133volcano.mp3'},
                {text: 'inside', lang: 'en-US', audioUrl: 'Auff4/134inside.mp3'},
                {text: 'hole', lang: 'en-US', audioUrl: 'Auff4/135hole.mp3'},
                {text: 'erupt', lang: 'en-US', audioUrl: 'Auff4/136erupt.mp3'},
                {text: 'lava', lang: 'en-US', audioUrl: 'Auff4/137lava.mp3'}
                ];

                // N·∫øu mu·ªën d√πng file √¢m thanh thay th·∫ø TTS, set audioUrl: 'audio/files/apple.mp3'

                // --- tr·∫°ng th√°i ---
                let idx = 0;
                let score = 0;

                // --- element refs ---
                const playBtn = document.getElementById('playBtn');
                const repeatBtn = document.getElementById('repeatBtn');
                const checkBtn = document.getElementById('checkBtn');
                const nextBtn = document.getElementById('nextBtn');
                const showBtn = document.getElementById('showBtn');
                const resetBtn = document.getElementById('resetBtn');
                const answerInput = document.getElementById('answer');
                const feedback = document.getElementById('feedback');
                const indexEl = document.getElementById('index');
                const totalEl = document.getElementById('total');
                const scoreEl = document.getElementById('score');
                const wordListEl = document.getElementById('wordList');
                const langLabel = document.getElementById('langLabel');

                // populate UI list
                function renderWordList(){
                wordListEl.innerHTML = '';
                words.forEach(w=>{
                    const li = document.createElement('li');
                    li.textContent = w.text;
                    wordListEl.appendChild(li);
                });
                }
                renderWordList();

                totalEl.textContent = words.length;

                // helpers: speak using Web Speech API
                function speakText(text, lang='en-US'){
                if('speechSynthesis' in window){
                    window.speechSynthesis.cancel();
                    const u = new SpeechSynthesisUtterance(text);
                    u.lang = lang;
                    u.rate = 0.95; // h∆°i ch·∫≠m ƒë·ªÉ d·ªÖ nghe
                    window.speechSynthesis.speak(u);
                } else {
                    // fallback: try audio element if provided or alert
                    alert('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ SpeechSynthesis. B·∫°n c√≥ th·ªÉ d√πng file √¢m thanh ri√™ng.');
                }
                }

                // play current item (use audioUrl if exists; otherwise TTS)
                function playCurrent(){
                const item = words[idx];
                if(!item) return;
                langLabel.textContent = 'Ng√¥n ng·ªØ: ' + (item.lang || 'en-US');
                if(item.audioUrl){
                const a = new Audio(item.audioUrl);
                a.play();
                } else {
                // use TTS
                speakText(item.text, item.lang || 'en-US');
                }
                }

                // check answer (case-insensitive, trim)
                function normalize(s){
                return s.toString().trim().toLowerCase();
                }

                function checkAnswer(){
                const user = normalize(answerInput.value);
                const correct = normalize(words[idx].text);
                if(user === ''){
                    feedback.innerHTML = '<span class="small">B·∫°n ch∆∞a g√µ g√¨.</span>';
                    return;
                }
                if(user === correct){
                    feedback.innerHTML = `<strong style="color:var(--success)">Ch√≠nh x√°c! ‚úî</strong> ‚Äî ${words[idx].text}`;
                    score += 1;
                    scoreEl.textContent = score;
                } else {
                    feedback.innerHTML = `<strong style="color:var(--danger)">Sai</strong> ‚Äî b·∫°n g√µ: <em>${escapeHtml(answerInput.value)}</em>.`; 
                }
                }

                // helper to escape HTML in user input
                function escapeHtml(unsafe){
                return unsafe.replace(/[&<>"']/g, function(m){
                    return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m];
                });
                }

                function nextItem(){
                idx = (idx + 1) % words.length;
                indexEl.textContent = idx + 1;
                answerInput.value = '';
                feedback.textContent = '';
                // auto-play next
                setTimeout(()=>playCurrent(), 200);
                }

                function showAnswer(){
                feedback.innerHTML = `<span class="small">ƒê√°p √°n: <strong>${words[idx].text}</strong></span>`;
                }

                function resetAll(){
                idx = 0; score = 0; indexEl.textContent = idx + 1; scoreEl.textContent = score; answerInput.value = ''; feedback.textContent = '';
                }

                // init state
                indexEl.textContent = idx + 1;
                scoreEl.textContent = score;

                // button events
                playBtn.addEventListener('click', ()=>{
                playCurrent();
                answerInput.focus();
                });
                repeatBtn.addEventListener('click', ()=>{
                shuffleWords();
                answerInput.focus();
                });
                checkBtn.addEventListener('click', ()=>{
                checkAnswer();
                answerInput.focus();
                });
                nextBtn.addEventListener('click', ()=>{
                nextItem();
                answerInput.focus();
                });
                showBtn.addEventListener('click', ()=>{
                showAnswer();
                answerInput.focus();
                });
                resetBtn.addEventListener('click', ()=>{
                if(confirm('B·∫°n mu·ªën reset ƒëi·ªÉm v√† b·∫Øt ƒë·∫ßu l·∫°i?')) resetAll();
                answerInput.focus();
                });

                // --- SHUFFLE FUNCTION ---
                function shuffleWords(){
                for (let i = words.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [words[i], words[j]] = [words[j], words[i]];
                }
                idx = 0;
                indexEl.textContent = idx + 1;
                feedback.textContent = '';
                answerInput.value = '';
                renderWordList();
                playCurrent();
                }

                // keyboard: Enter to check, Ctrl+Enter to next, Space to play
                answerInput.addEventListener('keydown', (e)=>{
                if(e.key === 'Enter' && !e.ctrlKey) { e.preventDefault(); checkAnswer(); }
                if(e.key === 'Enter' && e.ctrlKey) { e.preventDefault(); nextItem(); }
                if(e.code === 'Space' && e.target === answerInput) { /* allow typing space */ }
                });

                // accessibility: announce when speech ends (approximate)
                if('speechSynthesis' in window){
                window.speechSynthesis.onvoiceschanged = ()=>{/* no-op: ensures voices loaded */};
                }

                // allow easy customization by exposing variables (for teacher/dev)
                window.EXERCISE = {words, playCurrent, checkAnswer, nextItem, resetAll};

                // If you want to preload audio files set audioUrl in words array and they will play instead of TTS.
            </script>
            <div style="
            display: grid;
            grid-template-columns: 150px;margin-right: 5px;">
            <p class="units"><a href="nghegotvl4f12.html" target="_self"><strong>Fluency Time 1-2</strong></a></p>
            <p class="units"><a href="nghegotvl4u7.html" target="_self"><strong>Unit 7</strong></a></p>
            <p class="units"><a href="nghegotvl4u8.html" target="_self"><strong>Unit 8</strong></a></p>
            <p class="units"><a href="nghegotvl4u9.html" target="_self"><strong>Unit 9</strong></a></p>
            <p class="units"><a href="nghegotvl4u10.html" target="_self"><strong>Unit 10</strong></a></p>
            <p class="units"><a href="nghegotvl4u11.html" target="_self"><strong>Unit 11</strong></a></p>
            <p class="units"><a href="nghegotvl4u12.html" target="_self"><strong>Unit 12</strong></a></p>
            <p class="units"><a href="nghegotvl4f34.html" target="_self"><strong>Fluency Time 3-4</strong></a></p>
            </div>
        </div>
        <div style="height: 50px;"></div>
    <!-- Ph·∫ßn ch√¢n trang -->
    <div style="
    display:grid;
    grid-template-columns: 300px 350px 500px 250px;
    background-color: rgb(176, 185, 176);
    padding-top: 20px;
    padding-bottom: 20px;
    padding-left: 30px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
        <div>&#128241 Zalo: 0969 453 840 (Ms.Nhung)</div>
        <div>&#128231 Email: thanhnhung846@gmail.com</div>
        <div></div>
        <div>Ho Chi Minh City, Viet Nam</div>
    </div>

    <!-- UNIQUE AUDIO FUNCTION -->
    <script>
        function playSound(id) {
            const audio = document.getElementById(id);
            if (audio) audio.play();
        }
    </script>
    
    </body>
</html>